## はじめに

このプロジェクトは、**iOS** と **Android** アプリでベジェ曲線による描画をしてみるサンプルです。  

![anim00](https://user-images.githubusercontent.com/13220051/88523946-b366f500-d033-11ea-90d4-3d2b4bfe004d.gif)  

実現したい目標は下記となります。  
・端末の解像度に合わせて出力サイズを調整することで、ボヤけない画像の生成  
・頂点（アンカーポイント）に情報をもたせることで、パラメータに応じた形状の変化  
・別々に作成したパーツをベジェ曲線的に結合させることで、スムーズなつなぎ目と動き  
・ストローク（線）やパレット（色）を組み合わせることで、表現のバリエーションをお手軽に  

見た目的にはある程度納得のいくところまできたのですが、処理速度がネックとなっております。  
大きくて滑らかな画像をリアルタイムにアニメーションさせようとすると激しく処理落ちします。  
速度面の改良が今後の検討課題となっています。  

----
## iOS で動作確認をする場合
**Xcode** から **/Prj_iOS/AppEnv.xcodeproj** を開いてコンパイルしてください。

### 実装環境
・macOS Catalina 10.15.6  
・Xcode 11.6(11E708)  

### 動作確認端末
・iPhoneX iOS 11.2  
・iPhone7plus iOS 13.3.1  
・iPhone6plus iOS 10.3.3  
・iPhone6 iOS 11.2.6  
・iPhone5s iOS 10.2  
・iPad(第六世代) iOS 12.2  

----
## Android で動作確認をする場合
**AndroidStudio** から **/Prj_Android** を開いてコンパイルしてください。

### 実装環境
・Windows 10  
・Android Studio 3.1.2  
・Java 1.8.0_152  
・NDK 17.0.4754217  

### 動作確認端末
・Nexus6 android 7.1.1  

----
## サンプルの操作に関して
アプリ起動後、デバッグメニューの **Bezier:Test** を選択すると下記のような画面が表示されます。  

![ss00](https://user-images.githubusercontent.com/13220051/88523921-ae09aa80-d033-11ea-9e72-ddf00e3a8ecd.png)

各種デバッグボタンを操作して画像の変化をお試しください。

### 制御ボタン
画面の右上に配置されているのが制御系のボタンです。  
・**EXIT** テストを終了して前の画面へ戻ります  
・**RANDOM** 各種パラメータをランダムで設定します  
・**COSTUME** 基本素材と別素材の合成（ネギのコスプレ）をします  
・**RESET** 表示設定をリセットします  
・**BG** 背景表示の切り替えを行います  
・**STR** 線（ストローク）を切り替えます  
・**COL** 色（パレット）を切り替えます  
・**PTH** パス（アンカーポイントの状況）表示を切り替えます  
・**FH** 素材の出力を左右反転をします  
・**FV** 素材の出力を上下反転をします  
・**GND** 表示の基本位置（キャラの足元／画像中央）を切りまえます  

### パラメータ増減ボタン
画面の右下に配置されているのがパラメータを増減させるボタンです。  
・**H** 素材の横方向のサイズ（体型が太い／細い）を増減します  
・**V** 素材の縦方向のサイズ（身長が高い／低い）を増減します  
・**T** 素材の回転を増減します  
・**S** 素材のサイズを増減します  
・**LR** 素材の左右の傾きを増減します  
・**UD** 素材の上下の傾きを増減します  

### パラメータアニメボタン
画面の左上に配置されているのがパラメータをアニメさせるボタンです。  
・**ANIM** アニメの切り替えを行います（このボタンが有効な場合に、以下の個別指定が反映されます）  
・**H** 素材の横方向のサイズ（体型が太い／細い）をアニメさせます  
・**V** 素材の縦方向のサイズ（身長が高い／低い）をアニメさせます  
・**T** 素材の回転をアニメさせます  
・**S** 素材のサイズをアニメさせます  
・**LR** 素材の左右の傾きをアニメさせます  
・**UD** 素材の上下の傾きをアニメさせます  
・**SWY** 素材を揺らします（髪などがなびきます）  
・**MOV** 素材の移動値の適用を切り替えます（オンで素材が引っ張られ、オフで解除されます）  
・**OFF** 個別のアニメ設定を全てオフにします  

### 補助ボタン
画面の左下に配置されているのが補助系のボタンです。  
・**S** 素材の出力サイズを変更します  
・**R** 素材の出力角度を変更します

**ご注意：スケールを大きくしすぎたりすると、各種パーツの個別サイズや回転などとの相乗作用により、描画バッファをオーバーフローしてしまうことがあります。アプリが落ちることがあるのでお気をつけください！**  

----
## ベジェ曲線の実装に関して
ベジェ関連の処理は **C++** にて実装しています。  

### ソースの格納場所
ソースファイルは **/Prj_Android/app/src/main/jni/** 以下となり、**shared** フォルダ以下を **iOS** 側と共有しています。  

ベジェの描画関連のコードは、**shared/draw/tex/bezier** に格納されています。  
上記ベジェの描画で利用するストローク（線）関連のコードは、**shared/draw/tex/stroke** に、塗り（色）関連のコードは、**shared/draw/tex/fill** に格納されています。  

また、ベジェの描画を管理して画像を生成する窓口となるコードは、**shared/draw/tex/bmp** に、アンカーポイントの調整に関わるコードは、**shared/draw/tex/adjust** に格納されています。  

細かな実装に関しては、ソースコードとコメントをご確認ください。

### テストコード
サンプルの画像を表示する以外に、基本的なベジェ曲線の処理を確認するテストコードが格納されています。  
サンプル画面のコードである、**/shared/app/loop/bezier/BezierTestLoop.cpp** 内にて、**#define LAYER_BASE** の切り替えで各種のテストが確認できます。
こちらに関しても、ソースコードとコメントをご確認ください。

----
## 動作例

↓ 線（ストローク）や色（パレット）の差し替えと、パラメータによる体型の変化
![anim01](https://user-images.githubusercontent.com/13220051/88523959-b7931280-d033-11ea-8317-bca5b72ac245.gif)  
　  

↓ コスチューム（ネギの着ぐるみ）による体の差し替えと、パラメータによるポーズの変化  
![anim02](https://user-images.githubusercontent.com/13220051/88523969-bb269980-d033-11ea-95e2-e5d4bfb65764.gif)  

