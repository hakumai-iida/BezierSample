## はじめに

このプロジェクトは、**iOS** と **Android** アプリでベジェ曲線による描画をしてみるサンプルです。  

![anim_01_miku](https://user-images.githubusercontent.com/13220051/91286530-83914580-e7c9-11ea-9b94-399fe3a1ad7f.gif)  

目指している目標は下記となります。  
・端末の解像度に合わせて出力サイズを調整することで、ボヤけない画像の生成  
・頂点（アンカーポイント）に情報をもたせることで、パラメータに応じた形状の変化  
・ストローク（線）やパレット（色）を組み合わせることで、表現のバリエーションをお手軽に  
・別々に作成したパーツをベジェ曲線的に結合させることで、つなぎ目をスムーズに

現状、処理速度がネックとなっております。  
アニメーションで処理落ちしてしまう点は、ご了承くださいませ。  

----
## iOS で動作確認をする場合
**Xcode** から **/Prj_iOS/AppEnv.xcodeproj** を開いてコンパイルしてください。

### 実装環境
・macOS Catalina 10.15.6  
・Xcode 11.6(11E708)  

----
## Android で動作確認をする場合
**AndroidStudio** から **/Prj_Android** を開いてコンパイルしてください。

### 実装環境
・Windows 10  
・Android Studio 3.1.2  
・Java 1.8.0_152  
・NDK 17.0.4754217  

----
## サンプルの操作に関して
アプリ起動後、デバッグメニューの **Bezier:Test** を選択すると下記のような画面が表示されます。  

![title](https://user-images.githubusercontent.com/13220051/99179159-27054d00-275e-11eb-903a-64283e0b9ac6.png)  

各種デバッグＵＩを操作して表示の変化をお試しください。

### 制御ボタン
**画面の右上**に配置されているのが制御系のボタンです。  
・**EXIT**: テストを終了して前の画面へ戻ります  
・**RESET**: 表示設定をリセットします  
・**RANDOM**: 各種パラメータをランダムに変更します  

### 機能メニュー
**画面の上部**に配置されているのが機能メニューです。  
プルダウン形式となっており項目を決定するたびに関連する表示が切り替わります。  
（※じゃまになる場合、メニューの右にある（▼）ボタンで閉じてください）

・**chara**: 素体（キャラクタ）を選択します  
・**face**: 素体（キャラクタ）の顔を固定します  
・**up**: 素体（キャラクタ）の上半身を固定します  
・**low**: 素体（キャラクタ）の下半身を固定します  
・**cosutume**: コスチューム（胴体の差し替え）を選択します  
・**stroke**: ストローク（線）を切り替えます  
・**color**: 色（パレット）を切り替えます  
・**touch**: タッチの有効／無効を切り替えます  
・**stripe**: ストライプの有効／無効を切り替えます  
・**frill**: フリルの有効／無効を切り替えます  
・**edge**: エッジ塗りの有効／無効を切り替えます  
・**fill option**: シフト明暗の有効／無効を切り替えます  
・**work path**: 作業パスの表示を切り替えます  
・**bg**: 背景表示を切り替えます  
・**flip h**: 素材の出力を左右反転します  
・**flip v**: 素材の出力を上下反転します  
・**on ground**: 表示の基本位置（キャラの足元／画像中央）を切りまえます  

### パラメータ増減ボタン
**画面の右下**に配置されているのがパラメータを増減させるボタンです。  
・**H**: 素材の横方向のサイズ（体型が太い／細い）を増減します  
・**V**: 素材の縦方向のサイズ（身長が高い／低い）を増減します  
・**T**: 素材の回転を増減します  
・**S**: 素材のサイズを増減します  
・**LR**: 素材の左右の傾きを増減します  
・**UD**: 素材の上下の傾きを増減します  

### パラメータアニメボタン
**画面の左上**に配置されているのがパラメータをアニメさせるボタンです。  
・**ANIM**: アニメの切り替えを行います（このボタンが有効な場合に、以下の個別指定が反映されます）  
・**H**: 素材の横方向のサイズ（体型が太い／細い）をアニメさせます  
・**V**: 素材の縦方向のサイズ（身長が高い／低い）をアニメさせます  
・**T**: 素材の回転をアニメさせます  
・**S**: 素材のサイズをアニメさせます  
・**LR**: 素材の左右の傾きをアニメさせます  
・**UD**: 素材の上下の傾きをアニメさせます  
・**SWY**: 素材を揺らします（髪などがなびきます）  
・**MOV**: 素材の移動値の適用を切り替えます（オンで素材が引っ張られ、オフで解除されます）  
・**OFF**: 個別のアニメ設定を全てオフにします  

### 補助ボタン
**画面の左下**に配置されているのが補助系のボタンです。  
・**S** 素材の出力サイズを変更します  
・**R** 素材の出力角度を変更します

**ご注意：スケールを大きくしすぎたりすると、各種パーツの個別サイズや回転などとの相乗作用により、描画バッファをオーバーフローしてしまうことがあります。塗りがはみ出してしまったり、アプリが落ちることがあるのでお気をつけください！**  

----
## ベジェ曲線の実装に関して
ベジェ関連の処理は **C++** にて実装しています。  

### ソースの格納場所
ソースファイルは **/Prj_Android/app/src/main/jni/** 以下となり、**shared** フォルダ以下を **iOS** 側と共有しています。  

ベジェの描画関連のコードは **shared/draw/bezier** に格納されています。  
上記ベジェの描画で利用するストローク（線）関連のコードは **shared/draw/bezier/stroke** に、塗り（色）関連のコードは **shared/draw/bezier/fill** に、アンカーポイントの調整に関わるコードは **shared/draw/bezier/adjust** に、それぞれ格納されています。

また、ベジェの描画を管理して画像を生成する窓口となるコードは **shared/draw/bmp** に格納されています。  

細かな実装に関しては、ソースコードとコメントをご確認ください。

### テストコード
サンプルの画像を表示する以外に、基本的なベジェ曲線の処理を確認するテストコードが格納されています。  
サンプル画面のコードである、**/shared/app/loop/bezier/BezierTestLoop.cpp** 内にて、**#define LAYER_BASE** の切り替えで各種のテストが確認できます。
こちらに関しても、ソースコードとコメントをご確認ください。

----
## より詳しい説明  
**Qiita** にこのサンプルの処理に関する記事を投稿してあります。  
描画の詳細に関してお知りになりたい方はご覧ください。  

[**【ゲームアプリとベジェ曲線：その①】環境準備とアンカーポイント(点)による形の変化**](https://qiita.com/hakumai-iida/items/57d27776176eb4f1e9f1)】    

[**【ゲームアプリとベジェ曲線：その②】ストローク(線)による表現の付け足し**](https://qiita.com/hakumai-iida/items/fb688ed3df5cb2cf23c9)】   

[**【ゲームアプリとベジェ曲線：その③(完結)】：パーツによる絵のバリエーション**](https://qiita.com/hakumai-iida/items/22c4369677d5e0ea0261)】   

----
## サンプル画像  

↓ 体型パラメータ：体が細い〜太い  
![ss_00](https://user-images.githubusercontent.com/13220051/88622525-f67da280-d0dd-11ea-976e-76aa455a094f.gif)  
　  

↓ 体型パラメータ：身長が低い〜高い  
![ss_01](https://user-images.githubusercontent.com/13220051/88622531-fa112980-d0dd-11ea-8d71-958a6418f945.gif)  
　  

↓ 擬似傾け：左右  
![ss_04](https://user-images.githubusercontent.com/13220051/88622552-04332800-d0de-11ea-8721-413ad895966e.gif)  
　  

↓ 擬似傾け：上下  
![ss_05](https://user-images.githubusercontent.com/13220051/88622563-07c6af00-d0de-11ea-8741-6c5445f1d806.gif)  
　  

↓ 移動値適用：髪等のなびき  
![ss_06](https://user-images.githubusercontent.com/13220051/88622569-0bf2cc80-d0de-11ea-8acb-d1f69a4f4f39.gif)  
　  

↓ ストローク切り替え  
![ss_07](https://user-images.githubusercontent.com/13220051/88622582-12814400-d0de-11ea-8f93-01fe65c302c7.gif)  
　  

↓ パレット切り替え  
![ss_08](https://user-images.githubusercontent.com/13220051/88622589-16ad6180-d0de-11ea-987e-de17a28f09fd.gif)  
　  

↓ 各種表現の適用イメージ  
![img_06_goth](https://user-images.githubusercontent.com/13220051/91286550-868c3600-e7c9-11ea-9aab-ba3034482cbe.png)  

　  
↓ 基本素体一覧  
![ss01](https://user-images.githubusercontent.com/13220051/99161973-7423f780-273b-11eb-9bd8-6dbc334e593e.png)


↓ パーツのシャッフルによるランダムなキャラクタ描画  
![ss02](https://user-images.githubusercontent.com/13220051/99161974-7423f780-273b-11eb-89ed-464af3a615a2.png)  


↓ ランダムなキャラクタによるアニメーション  
![ss03](https://user-images.githubusercontent.com/13220051/99161975-74bc8e00-273b-11eb-812e-fbd6e5fbb618.gif)  
